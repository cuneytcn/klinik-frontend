---
import BaseLayout from "../layouts/base-layout.astro";

// Environment variables'ları server-side'da al
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;
---

<BaseLayout
  title="İletişim - Kıymet Veteriner Kliniği | İzmir Bornova"
  description="Kıymet Veteriner Kliniği iletişim bilgileri. İzmir Bornova'da Hürriyet Cd. No:238 adresinde. Tel: (0232) 351 52 53, Acil: +90 538 694 44 55"
  keywords="veteriner iletişim İzmir, Bornova veteriner telefon, acil veteriner numarası, Kıymet Veteriner adres"
>
  <main class="pt-20">
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-sky-50 to-white py-20">
      <div class="container mx-auto px-4 lg:px-6">
        <div class="mb-16 text-center">
          <h1 class="mb-6 text-5xl font-bold text-gray-900">İletişim</h1>
          <p class="mx-auto max-w-3xl text-xl text-gray-600">
            Kıymet Veteriner Kliniği olarak sorularınız için buradayız. İzmir
            Bornova'da evcil dostlarınız için size yardımcı olmaktan mutluluk
            duyarız.
          </p>
        </div>
      </div>
    </section>

    <!-- Contact Info & Form -->
    <section class="py-20">
      <div class="container mx-auto px-4 lg:px-6">
        <div class="grid grid-cols-1 gap-16 lg:grid-cols-2">
          <!-- Contact Information -->
          <div>
            <h2 class="mb-8 text-3xl font-bold text-gray-900">
              İletişim Bilgileri
            </h2>

            <div class="space-y-8">
              <!-- Address -->
              <div class="flex items-start space-x-4">
                <div
                  class="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-xl bg-sky-500"
                >
                  <svg
                    class="h-6 w-6 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                    ></path>
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                </div>
                <div>
                  <h3 class="mb-2 text-xl font-semibold text-gray-900">
                    Adresimiz
                  </h3>
                  <p class="leading-relaxed text-gray-600">
                    İnönü, Hürriyet Cd. No:238<br />
                    35030 Bornova / İzmir
                  </p>
                </div>
              </div>

              <!-- Phone -->
              <div class="flex items-start space-x-4">
                <div
                  class="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-xl bg-green-500"
                >
                  <svg
                    class="h-6 w-6 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                    ></path>
                  </svg>
                </div>
                <div>
                  <h3 class="mb-2 text-xl font-semibold text-gray-900">
                    Telefon Numaraları
                  </h3>
                  <div class="space-y-2">
                    <a
                      href="tel:+902323515253"
                      class="block text-gray-600 transition-colors hover:text-sky-600"
                    >
                      (0232) 351 52 53 (Klinik)
                    </a>
                    <a
                      href="tel:+905386944455"
                      class="block font-semibold text-red-600 transition-colors hover:text-red-700"
                    >
                      +90 538 694 44 55 (Acil Hat - 7/24)
                    </a>
                  </div>
                </div>
              </div>

              <!-- Email -->
              <div class="flex items-start space-x-4">
                <div
                  class="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-xl bg-purple-500"
                >
                  <svg
                    class="h-6 w-6 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                    ></path>
                  </svg>
                </div>
                <div>
                  <h3 class="mb-2 text-xl font-semibold text-gray-900">
                    E-posta
                  </h3>
                  <div class="space-y-2">
                    <a
                      href="mailto:info@kiymetveteriner.com"
                      class="block text-gray-600 transition-colors hover:text-sky-600"
                    >
                      info@kiymetveteriner.com
                    </a>
                    <a
                      href="mailto:randevu@kiymetveteriner.com"
                      class="block text-gray-600 transition-colors hover:text-sky-600"
                    >
                      randevu@kiymetveteriner.com
                    </a>
                  </div>
                </div>
              </div>

              <!-- Working Hours -->
              <div class="flex items-start space-x-4">
                <div
                  class="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-xl bg-orange-500"
                >
                  <svg
                    class="h-6 w-6 text-white"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
                <div>
                  <h3 class="mb-2 text-xl font-semibold text-gray-900">
                    Çalışma Saatleri
                  </h3>
                  <div class="space-y-1 text-gray-600">
                    <p><strong>Pazartesi:</strong> 09:00 - 21:00</p>
                    <p><strong>Salı:</strong> 09:00 - 21:00</p>
                    <p><strong>Çarşamba:</strong> 09:00 - 21:00</p>
                    <p><strong>Perşembe:</strong> 09:00 - 21:00</p>
                    <p><strong>Cuma:</strong> 09:00 - 21:00</p>
                    <p><strong>Cumartesi:</strong> 09:00 - 20:00</p>
                    <p><strong>Pazar:</strong> 12:00 - 17:00</p>
                    <p class="mt-2 font-semibold text-red-600">
                      Acil Durum: 7/24
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Emergency Call Card -->
            <div
              class="mt-12 rounded-2xl bg-gradient-to-r from-red-500 to-red-600 p-6 text-white"
            >
              <div class="flex items-center space-x-4">
                <div
                  class="flex h-12 w-12 items-center justify-center rounded-xl bg-white/20"
                >
                  <svg
                    class="h-6 w-6 animate-pulse"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                    ></path>
                  </svg>
                </div>
                <div>
                  <h3 class="mb-1 text-xl font-bold">Acil Durum?</h3>
                  <p class="opacity-90">Hemen arayın, 7/24 hizmetinizdeyiz</p>
                </div>
                <a
                  href="tel:+905386944455"
                  class="ml-auto rounded-xl bg-white px-6 py-3 font-bold text-red-600 transition-colors hover:bg-gray-100"
                >
                  ARA
                </a>
              </div>
            </div>
          </div>

          <!-- Contact Form -->
          <div class="rounded-3xl bg-white p-8 shadow-lg">
            <h2 class="mb-8 text-3xl font-bold text-gray-900">Bize Yazın</h2>

            <form id="contact-form" class="space-y-6">
              <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                <div>
                  <label
                    for="firstName"
                    class="mb-2 block text-sm font-semibold text-gray-700"
                  >
                    Adınız *
                  </label>
                  <input
                    type="text"
                    id="firstName"
                    name="firstName"
                    required
                    class="w-full rounded-xl border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-sky-500"
                    placeholder="Adınız"
                  />
                </div>
                <div>
                  <label
                    for="lastName"
                    class="mb-2 block text-sm font-semibold text-gray-700"
                  >
                    Soyadınız *
                  </label>
                  <input
                    type="text"
                    id="lastName"
                    name="lastName"
                    required
                    class="w-full rounded-xl border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-sky-500"
                    placeholder="Soyadınız"
                  />
                </div>
              </div>

              <div>
                <label
                  for="email"
                  class="mb-2 block text-sm font-semibold text-gray-700"
                >
                  E-posta Adresiniz *
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  class="w-full rounded-xl border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-sky-500"
                  placeholder="ornek@email.com"
                />
              </div>

              <div>
                <label
                  for="phone"
                  class="mb-2 block text-sm font-semibold text-gray-700"
                >
                  Telefon Numaranız
                </label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  class="w-full rounded-xl border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-sky-500"
                  placeholder="+90 5xx xxx xx xx"
                />
              </div>

              <div>
                <label
                  for="subject"
                  class="mb-2 block text-sm font-semibold text-gray-700"
                >
                  Konu *
                </label>
                <select
                  id="subject"
                  name="subject"
                  required
                  class="w-full rounded-xl border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-sky-500"
                >
                  <option value="">Konu seçiniz</option>
                  <option value="randevu">Randevu Talebi</option>
                  <option value="bilgi">Genel Bilgi</option>
                  <option value="acil">Acil Durum</option>
                  <option value="sikayet">Şikayet/Öneri</option>
                  <option value="diger">Diğer</option>
                </select>
              </div>

              <div>
                <label
                  for="message"
                  class="mb-2 block text-sm font-semibold text-gray-700"
                >
                  Mesajınız *
                </label>
                <textarea
                  id="message"
                  name="message"
                  rows="6"
                  required
                  class="w-full resize-none rounded-xl border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-sky-500"
                  placeholder="Lütfen mesajınızı yazınız..."></textarea>
              </div>

              <div class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="privacy"
                  name="privacy"
                  required
                  class="h-4 w-4 rounded border-gray-300 text-sky-600 focus:ring-sky-500"
                />
                <label for="privacy" class="text-sm text-gray-600">
                  <a
                    href="/gizlilik-politikasi"
                    class="text-sky-600 hover:text-sky-700"
                    >Gizlilik Politikası</a
                  >'nı okudum ve kabul ediyorum. *
                </label>
              </div>

              <button
                type="submit"
                class="w-full rounded-xl bg-sky-600 px-6 py-4 font-semibold text-white shadow-lg transition-colors duration-200 hover:bg-sky-700 hover:shadow-xl"
              >
                Mesajı Gönder
              </button>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- Map Section -->
    <section class="bg-gray-50 py-20">
      <div class="container mx-auto px-4 lg:px-6">
        <div class="mb-12 text-center">
          <h2 class="mb-4 text-4xl font-bold text-gray-900">Konumumuz</h2>
          <p class="text-xl text-gray-600">Bizi kolayca bulabilirsiniz</p>
        </div>

        <div class="relative overflow-hidden rounded-3xl bg-white shadow-lg">
          <div class="flex h-96 items-center justify-center bg-gray-200">
            <div class="text-center">
              <svg
                class="mx-auto mb-4 h-16 w-16 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>

              <iframe
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3123.100790041949!2d27.199961976455846!3d38.48531617091278!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x14b97df550d02fed%3A0xc7bf7da51ca7e53d!2sK%C4%B1ymet%20Veteriner%20Klini%C4%9Fi!5e0!3m2!1str!2str!4v1753276797299!5m2!1str!2str"
                width="600"
                height="450"
                style="border:0;"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade"
                class="absolute inset-0 h-full w-full"></iframe>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<script
  define:vars={{
    supabaseUrl: import.meta.env.VITE_SUPABASE_URL,
    supabaseKey: import.meta.env.VITE_SUPABASE_ANON_KEY,
  }}
>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("contact-form");
    if (form) {
      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        const submitButton = form.querySelector('button[type="submit"]');
        const originalText = submitButton.textContent;

        // Loading state
        submitButton.textContent = "Gönderiliyor...";
        submitButton.disabled = true;

        try {
          console.log("Form submit başladı...");

          const formData = new FormData(form);

          // Form verilerini kontrol et
          const formValues = {
            firstName: formData.get("firstName"),
            lastName: formData.get("lastName"),
            email: formData.get("email"),
            phone: formData.get("phone"),
            subject: formData.get("subject"),
            message: formData.get("message"),
            privacy: formData.get("privacy"),
          };

          console.log("Form verileri:", formValues);

          // Zorunlu alanları kontrol et
          if (
            !formValues.firstName ||
            !formValues.lastName ||
            !formValues.email ||
            !formValues.subject ||
            !formValues.message ||
            !formValues.privacy
          ) {
            alert(
              "Lütfen tüm zorunlu alanları doldurun ve gizlilik politikasını kabul edin.",
            );
            return;
          }

          // Environment variables'ları kontrol et (artık define:vars ile geliyor)
          console.log("Environment variables:", {
            url: supabaseUrl ? "Mevcut" : "Yok",
            key: supabaseKey ? "Mevcut" : "Yok",
          });

          if (!supabaseUrl || !supabaseKey) {
            console.error("Supabase environment variables eksik!");
            alert(
              "Konfigürasyon hatası. Lütfen sistem yöneticisi ile iletişime geçin.",
            );
            return;
          }

          console.log("Supabase client oluşturuluyor...");
          // Supabase client'ı doğrudan burada oluştur
          const { createClient } = await import(
            "https://esm.sh/@supabase/supabase-js@2"
          );
          const supabase = createClient(supabaseUrl, supabaseKey);
          console.log("Supabase client başarıyla oluşturuldu");

          const insertData = {
            first_name: formValues.firstName,
            last_name: formValues.lastName,
            email: formValues.email,
            phone: formValues.phone || null,
            subject: formValues.subject,
            message: formValues.message,
            privacy_accepted: formValues.privacy === "on",
          };

          console.log("Veritabanına gönderilecek veri:", insertData);

          const { data, error } = await supabase
            .from("contacts")
            .insert([insertData]);

          console.log("Supabase yanıtı:", { data, error });

          if (error) {
            console.error("Supabase hatası:", error);
            alert(`Veritabanı hatası: ${error.message}`);
          } else {
            console.log("Form başarıyla gönderildi!");
            alert(
              "İletişim formunuz başarıyla gönderildi. En kısa sürede size dönüş yapacağız.",
            );
            form.reset();
          }
        } catch (err) {
          console.error("Beklenmeyen hata:", err);
          console.error("Hata detayı:", JSON.stringify(err, null, 2));
          alert("Bir hata oluştu. Konsolu kontrol edin ve tekrar deneyin.");
        } finally {
          // Reset button state
          submitButton.textContent = originalText;
          submitButton.disabled = false;
        }
      });
    }
  });
</script>
